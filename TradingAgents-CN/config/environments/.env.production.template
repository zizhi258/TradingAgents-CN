# =============================================================================
# Production Environment Configuration for TradingAgents-CN with ChartingArtist
# Complete configuration template for production deployment
# =============================================================================

# Environment identification
ENVIRONMENT=production
VERSION=1.0.0
BUILD_DATE=2024-01-01T00:00:00Z
VCS_REF=main

# =============================================================================
# Core Application Configuration
# =============================================================================

# Application settings
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1
PYTHONPATH=/app
TZ=Asia/Shanghai

# Logging configuration
TRADINGAGENTS_LOG_LEVEL=INFO
TRADINGAGENTS_LOG_DIR=/app/logs
LOG_FORMAT=structured
LOG_ROTATION_SIZE=100MB
LOG_RETENTION_DAYS=30

# =============================================================================
# Database Configuration
# =============================================================================

# MongoDB configuration
MONGODB_HOST=mongodb
MONGODB_PORT=27017
MONGODB_DATABASE=tradingagents
MONGODB_USERNAME=admin
MONGODB_PASSWORD=CHANGE_ME_MONGODB_STRONG_PASSWORD_123!
TRADINGAGENTS_MONGODB_URL=mongodb://admin:${MONGODB_PASSWORD}@mongodb:27017/tradingagents?authSource=admin

# MongoDB performance settings
MONGODB_MAX_POOL_SIZE=50
MONGODB_MIN_POOL_SIZE=5
MONGODB_MAX_IDLE_TIME_MS=30000
MONGODB_SERVER_SELECTION_TIMEOUT_MS=5000

# =============================================================================
# Cache and Message Broker Configuration
# =============================================================================

# Redis configuration
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_REDIS_STRONG_PASSWORD_456!
TRADINGAGENTS_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
REDIS_DB=0

# Redis performance settings
REDIS_MAX_CONNECTIONS=100
REDIS_CONNECTION_POOL_SIZE=20
REDIS_SOCKET_TIMEOUT=5
REDIS_RETRY_ON_TIMEOUT=true

# Cache configuration
TRADINGAGENTS_CACHE_TYPE=redis
CACHE_TTL=3600
CACHE_MAX_SIZE=1000
CACHE_ENABLED=true

# =============================================================================
# Multi-Model and AI Configuration
# =============================================================================

# Multi-model framework
MULTI_MODEL_ENABLED=true
ROUTING_STRATEGY=intelligent
DEFAULT_COLLABORATION_MODE=sequential
MAX_COST_PER_SESSION=1.0
ENABLE_MODEL_FALLBACK=true

# API Keys (Set these as secrets in production)
GOOGLE_API_KEY=CHANGE_ME_GOOGLE_API_KEY
FINNHUB_API_KEY=CHANGE_ME_FINNHUB_API_KEY
DEEPSEEK_API_KEY=CHANGE_ME_DEEPSEEK_API_KEY
OPENAI_API_KEY=CHANGE_ME_OPENAI_API_KEY
CLAUDE_API_KEY=CHANGE_ME_CLAUDE_API_KEY

# Model configuration
DEFAULT_MODEL_PROVIDER=google
MODEL_TIMEOUT_SECONDS=60
MODEL_MAX_RETRIES=3
MODEL_RETRY_DELAY=2

# =============================================================================
# ChartingArtist Configuration
# =============================================================================

# ChartingArtist service
CHARTING_ARTIST_ENABLED=true
CHARTING_ARTIST_API_URL=http://charting-service:8002/api
CHARTING_ARTIST_SERVICE_TIMEOUT=60
CHARTING_ARTIST_MAX_RETRIES=2

# Chart generation settings
CHARTING_ARTIST_CACHE_SIZE=100
CHARTING_ARTIST_MAX_CONCURRENT_JOBS=3
CHARTING_WORKER_CONCURRENCY=2
ENABLE_CHART_GENERATION=true

# Chart storage configuration
CHART_STORAGE_PATH=/app/data/attachments/charts
CHART_CACHE_PATH=/app/data/chart_cache
CHART_RETENTION_DAYS=30
CHART_MAX_FILE_SIZE_MB=50
CHART_CLEANUP_ENABLED=true
CHART_BACKUP_ENABLED=false

# Chart generation performance
CHART_GENERATION_TIMEOUT=120
CHART_QUEUE_MAX_SIZE=200
CHART_BATCH_SIZE=5
CHART_PARALLEL_PROCESSING=true

# Chart export formats
CHART_DEFAULT_FORMAT=html
CHART_EXPORT_FORMATS=html,json,png,svg
CHART_DEFAULT_THEME=plotly_dark
CHART_DEFAULT_WIDTH=800
CHART_DEFAULT_HEIGHT=600

# =============================================================================
# Web Application Configuration
# =============================================================================

# Streamlit settings
WEB_PORT=8501
STREAMLIT_SERVER_PORT=8501
STREAMLIT_SERVER_ADDRESS=0.0.0.0
STREAMLIT_SERVER_HEADLESS=true
STREAMLIT_SERVER_ENABLE_CORS=false
STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION=true
STREAMLIT_BROWSER_GATHER_USAGE_STATS=false

# Web application performance
STREAMLIT_SERVER_MAX_MESSAGE_SIZE=200
STREAMLIT_SERVER_MAX_UPLOAD_SIZE=200
STREAMLIT_SERVER_ENABLE_STATIC_SERVING=true

# =============================================================================
# API Configuration
# =============================================================================

# API service settings
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_WORKER_CLASS=uvicorn.workers.UvicornWorker
API_WORKER_CONNECTIONS=1000
API_MAX_REQUESTS=1000
API_MAX_REQUESTS_JITTER=50
API_TIMEOUT=30

# API performance and security
API_RATE_LIMIT=100
API_RATE_LIMIT_WINDOW=60
API_MAX_PAYLOAD_SIZE=10MB
API_CORS_ENABLED=false
API_CORS_ORIGINS=https://yourdomain.com
ENABLE_PERFORMANCE_MONITORING=true

# ChartingArtist API specific
CHARTING_PORT=8002
CHARTING_API_RATE_LIMIT=50
CHARTING_API_TIMEOUT=120
CHARTING_API_MAX_CONCURRENT=10

# =============================================================================
# Worker and Background Task Configuration
# =============================================================================

# Celery configuration
CELERY_BROKER_URL=${TRADINGAGENTS_REDIS_URL}
CELERY_RESULT_BACKEND=${TRADINGAGENTS_REDIS_URL}
CELERY_WORKER_CONCURRENCY=4
CELERY_MAX_TASKS_PER_CHILD=100
CELERY_TASK_TIME_LIMIT=3600
CELERY_TASK_SOFT_TIME_LIMIT=3000
CELERY_WORKER_PREFETCH_MULTIPLIER=1

# Background task settings
ENABLE_BACKGROUND_TASKS=true
TASK_QUEUE_MAX_SIZE=1000
TASK_RETRY_DELAY=60
TASK_MAX_RETRIES=3

# Scheduler configuration
SCHEDULER_ENABLED=true
SCHEDULER_TIMEZONE=Asia/Shanghai
MARKET_ANALYSIS_SCHEDULE="0 9,15 * * 1-5"
CLEANUP_SCHEDULE="0 2 * * *"

# =============================================================================
# Security Configuration
# =============================================================================

# Container security
DOCKER_CONTAINER=true
RUN_AS_NON_ROOT=true
USER_ID=1001
GROUP_ID=1001

# Application security
PYTHONHASHSEED=random
SECURE_HEADERS_ENABLED=true
SESSION_SECURITY_ENABLED=true
CSRF_PROTECTION_ENABLED=true

# Network security
INTERNAL_NETWORK_ONLY=false
ALLOWED_HOSTS=localhost,127.0.0.1,yourdomain.com
TRUSTED_PROXIES=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# SSL/TLS configuration
SSL_ENABLED=false
SSL_CERT_PATH=/app/certs/cert.pem
SSL_KEY_PATH=/app/certs/key.pem
SSL_VERIFY_MODE=CERT_REQUIRED

# =============================================================================
# Monitoring and Observability
# =============================================================================

# Prometheus metrics
ENABLE_METRICS=true
METRICS_PORT=9090
METRICS_PATH=/metrics
METRICS_INCLUDE_DEFAULT=true

# Health checks
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_TIMEOUT=30
HEALTH_CHECK_INTERVAL=60
HEALTH_CHECK_RETRIES=3

# Distributed tracing
ENABLE_TRACING=false
JAEGER_AGENT_HOST=jaeger-agent
JAEGER_AGENT_PORT=6831
TRACE_SAMPLE_RATE=0.1

# Application metrics
APP_METRICS_ENABLED=true
CHART_METRICS_ENABLED=true
PERFORMANCE_METRICS_ENABLED=true
BUSINESS_METRICS_ENABLED=true

# =============================================================================
# External Service Configuration
# =============================================================================

# Load balancer / Reverse proxy
HTTP_PORT=80
HTTPS_PORT=443
DOMAIN=localhost
USE_SSL=false
PROXY_BUFFER_SIZE=64k
PROXY_TIMEOUT=60

# CDN configuration
CDN_ENABLED=false
CDN_URL=https://cdn.yourdomain.com
STATIC_FILES_CDN=false

# Email configuration
SMTP_ENABLED=false
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_USE_TLS=true
SMTP_USERNAME=noreply@yourdomain.com
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD

# Notification settings
ALERTS_ENABLED=true
SLACK_WEBHOOK_URL=CHANGE_ME_SLACK_WEBHOOK
DISCORD_WEBHOOK_URL=CHANGE_ME_DISCORD_WEBHOOK
EMAIL_ALERTS_ENABLED=false
EMAIL_RECIPIENTS=admin@yourdomain.com

# =============================================================================
# Backup and Disaster Recovery
# =============================================================================

# Backup configuration
BACKUP_ENABLED=false
BACKUP_SCHEDULE="0 3 * * *"
BACKUP_RETENTION_DAYS=30
BACKUP_STORAGE_PATH=/app/backups
BACKUP_COMPRESSION=gzip

# Database backup
DB_BACKUP_ENABLED=false
DB_BACKUP_SCHEDULE="0 2 * * *"
DB_BACKUP_RETENTION=7
MONGODB_BACKUP_PATH=/app/backups/mongodb

# Chart data backup
CHART_BACKUP_ENABLED=false
CHART_BACKUP_SCHEDULE="0 4 * * *"
CHART_BACKUP_RETENTION=14
CHART_BACKUP_COMPRESSION=true

# =============================================================================
# Development and Debug Configuration
# =============================================================================

# Debug settings (disable in production)
DEBUG_MODE=false
ENABLE_DEBUG_LOGGING=false
ENABLE_PROFILING=false
ENABLE_DEV_TOOLS=false

# Testing configuration
TESTING_MODE=false
TEST_DATABASE_URL=mongodb://admin:testpass@mongodb:27017/tradingagents_test?authSource=admin
MOCK_EXTERNAL_APIS=false

# Feature flags
EXPERIMENTAL_FEATURES=false
ENABLE_BETA_FEATURES=false
FEATURE_FLAG_CHARTING_V2=false
FEATURE_FLAG_ADVANCED_ANALYTICS=false

# =============================================================================
# Resource Limits and Performance Tuning
# =============================================================================

# Memory settings
MAX_MEMORY_USAGE=2048M
MEMORY_WARNING_THRESHOLD=1536M
GARBAGE_COLLECTION_THRESHOLD=0.7

# CPU settings
MAX_CPU_USAGE=2.0
CPU_WARNING_THRESHOLD=1.5

# I/O settings
MAX_DISK_USAGE=10GB
DISK_WARNING_THRESHOLD=8GB
MAX_OPEN_FILES=65536

# Network settings
MAX_CONNECTIONS=1000
CONNECTION_TIMEOUT=30
KEEP_ALIVE_TIMEOUT=65

# =============================================================================
# Deployment Configuration
# =============================================================================

# Container registry
REGISTRY=ghcr.io
IMAGE_NAME_WEB=tradingagents-cn-web
IMAGE_NAME_API=tradingagents-cn-api
TAG=latest

# Deployment strategy
DEPLOYMENT_STRATEGY=rolling
MAX_UNAVAILABLE=1
MAX_SURGE=1
READINESS_PROBE_DELAY=30
LIVENESS_PROBE_DELAY=60

# Scaling configuration
AUTO_SCALING_ENABLED=false
MIN_REPLICAS=1
MAX_REPLICAS=5
TARGET_CPU_UTILIZATION=70
TARGET_MEMORY_UTILIZATION=80

# =============================================================================
# Service-Specific Port Configuration
# =============================================================================

# Service ports
WEB_PORT=8501
API_PORT=8000
CHARTING_PORT=8002
WORKER_PORT=8001
SCHEDULER_PORT=8003
FLOWER_PORT=5555

# Monitoring ports
PROMETHEUS_PORT=9090
GRAFANA_PORT=3000
ALERTMANAGER_PORT=9093

# Database ports
MONGODB_PORT=27017
REDIS_PORT=6379

# =============================================================================
# Docker Compose Override Settings
# =============================================================================

# Docker Compose profiles
COMPOSE_PROFILES=production,monitoring

# Service replica counts
WEB_REPLICAS=2
API_REPLICAS=2
WORKER_REPLICAS=2
CHARTING_REPLICAS=1

# Volume settings
VOLUME_DRIVER=local
VOLUME_BACKUP_ENABLED=true

# Network settings
NETWORK_DRIVER=bridge
NETWORK_EXTERNAL=false

# =============================================================================
# Environment-Specific Overrides
# =============================================================================

# Override for different environments
# Uncomment and modify as needed for staging, development, etc.

# # Staging environment
# ENVIRONMENT=staging
# DEBUG_MODE=true
# CHARTING_ARTIST_ENABLED=true
# BACKUP_ENABLED=false

# # Development environment
# ENVIRONMENT=development
# DEBUG_MODE=true
# TESTING_MODE=true
# MOCK_EXTERNAL_APIS=true