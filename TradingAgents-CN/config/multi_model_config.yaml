# Multi-Model Configuration
# å¤šæ¨¡å‹ç³»ç»Ÿé…ç½® - APIæä¾›å•†å’Œå…¨å±€è®¾ç½®

# APIæä¾›å•†é…ç½® - ä¸‰æ± æ——èˆ°æ¨¡å‹æ¶æ„
providers:
  # ğŸ§  é€šç”¨æ·±åº¦æ¨ç†æ±  - Google AI (Gemini-2.5-Pro æ——èˆ°)
  google_ai:
    enabled: true
    api_key_env: ["GOOGLE_AI_API_KEY", "GOOGLE_API_KEY", "GEMINI_API_KEY"]
    default_model: "gemini-2.5-pro"
    flagship_model: "gemini-2.5-pro"  # æ——èˆ°æ¨¡å‹
    fallback_models: ["Qwen/Qwen3-235B-A22B-Instruct-2507", "gemini-1.5-pro"]
    timeout: 120  # æ·±åº¦æ¨ç†éœ€æ›´é•¿æ—¶é—´
    max_retries: 3
    priority: 1  # æœ€é«˜ä¼˜å…ˆçº§
    pool_type: "deep_reasoning"
    description: "é€šç”¨æ·±åº¦æ¨ç†æ±  - å¤šæ¨¡æ€é€»è¾‘æ¨ç†æœ€ä½³ï¼Œè´¢æŠ¥PDFè§£æçªå‡º"
    capabilities: ["multimodal", "long_context", "financial_analysis", "reasoning_chains"]
    
  # ğŸ”„ æŠ€æœ¯é¢&é•¿åºåˆ—æ±  - SiliconFlow (DeepSeek-V3 æ——èˆ°)
  siliconflow:
    enabled: true
    api_key_env: "SILICONFLOW_API_KEY"
    base_url: "https://api.siliconflow.cn/v1"
    default_model: "deepseek-ai/DeepSeek-V3"
    flagship_model: "deepseek-ai/DeepSeek-V3"  # æ——èˆ°æ¨¡å‹
    fallback_models: ["deepseek-ai/DeepSeek-R1", "moonshotai/Kimi-K2-Instruct"]
    timeout: 90
    max_retries: 3
    priority: 2
    pool_type: "technical_longseq"
    description: "æŠ€æœ¯é¢&é•¿åºåˆ—æ±  - 100K+ä¸Šä¸‹æ–‡ï¼Œä¸­æ–‡å¯¹è¯èƒ½åŠ›æå¼º"
    capabilities: ["long_context", "chinese_optimized", "technical_analysis", "time_series"]
    
  # DeepSeek ç›´è¿ï¼ˆå¤‡ç”¨ï¼‰
  deepseek:
    enabled: true
    api_key_env: "DEEPSEEK_API_KEY"
    base_url: "https://api.deepseek.com"
    default_model: "deepseek-chat"
    timeout: 60
    max_retries: 3
    priority: 4
    pool_type: "backup"
    description: "DeepSeekç›´è¿å¤‡ç”¨æ± "

  # ğŸŒŸ Gemini-API å…¼å®¹(OpenAIåè®®åä»£) - å¤‡ç”¨/ç¨³å®šæ¸ é“
  gemini_api:
    enabled: true
    base_url: "${GEMINI_API_COMPAT_BASE_URL:-http://localhost:8080/v1}"
    default_model: "gemini-2.5-pro"
    timeout: 90
    max_retries: 2
    priority: 1
    pool_type: "deep_reasoning"
    description: "è‡ªå»º Gemini åä»£ï¼ˆOpenAI å…¼å®¹æ ¼å¼ï¼‰ï¼Œä¸å®˜æ–¹ SDK å¹¶å­˜ï¼Œå¯åˆ‡æ¢ç”¨äºé•¿æ–‡/ç¨³å®šæ€§"

# å…·ä½“æ¨¡å‹ç›®å½•ï¼ˆä¾¿äºå‰åç«¯ä¸€è‡´å¼•ç”¨ä¸ç­–ç•¥åŒ¹é…ï¼‰
model_catalog:
  siliconflow:
    - name: "deepseek-ai/DeepSeek-V3"
      tags: ["long_context", "chinese", "technical", "general"]
      cost_tier: "low"
    - name: "deepseek-ai/DeepSeek-R1"
      tags: ["reasoning", "think", "long_context"]
      cost_tier: "mid"
    - name: "Qwen/Qwen3-235B-A22B-Instruct-2507"
      tags: ["general", "chinese"]
      cost_tier: "mid"
    - name: "Qwen/Qwen3-235B-A22B-Thinking-2507"
      tags: ["reasoning", "think"]
      cost_tier: "mid"
    - name: "Qwen/Qwen3-Coder-480B-A35B-Instruct"
      tags: ["code_generation", "tools", "reasoning"]
      cost_tier: "mid"
    - name: "zai-org/GLM-4.5"
      tags: ["general", "chinese", "fast"]
      cost_tier: "low"
    - name: "moonshotai/Kimi-K2-Instruct"
      tags: ["long_context", "general", "chinese"]
      cost_tier: "mid"

# è§’è‰²åˆ°æ¨¡å‹/æ± çš„ç»‘å®šï¼ˆç™½/é»‘åå•ã€åå¥½ä¸å›é€€é“¾ï¼‰
agent_bindings:
  fundamental_expert:
    pools: ["deep_reasoning"]
    allow_models: ["gemini-2.5-pro", "Qwen/Qwen3-235B-A22B-Instruct-2507"]
    prefer_models: ["gemini-2.5-pro"]
    deny_models: []
    fallback_chain: ["gemini-2.5-pro", "Qwen/Qwen3-235B-A22B-Instruct-2507", "deepseek-ai/DeepSeek-R1"]
    max_cost_per_task: 0.05
  chief_decision_officer:
    pools: ["deep_reasoning"]
    allow_models: ["gemini-2.5-pro", "deepseek-ai/DeepSeek-R1"]
    prefer_models: ["gemini-2.5-pro"]
    fallback_chain: ["gemini-2.5-pro", "deepseek-ai/DeepSeek-R1"]
  technical_analyst:
    pools: ["technical_longseq"]
    allow_models: ["deepseek-ai/DeepSeek-V3", "zai-org/GLM-4.5"]
    prefer_models: ["deepseek-ai/DeepSeek-V3"]
    fallback_chain: ["deepseek-ai/DeepSeek-V3", "zai-org/GLM-4.5"]
  news_hunter:
    pools: ["technical_longseq"]
    allow_models: ["deepseek-ai/DeepSeek-V3", "Qwen/Qwen3-235B-A22B-Instruct-2507"]
    prefer_models: ["deepseek-ai/DeepSeek-V3"]
  sentiment_analyst:
    pools: ["technical_longseq"]
    allow_models: ["deepseek-ai/DeepSeek-V3", "zai-org/GLM-4.5"]
    prefer_models: ["zai-org/GLM-4.5"]
  tool_engineer:
    pools: ["technical_longseq"]
    allow_models: ["Qwen/Qwen3-Coder-480B-A35B-Instruct", "zai-org/GLM-4.5"]
    prefer_models: ["Qwen/Qwen3-Coder-480B-A35B-Instruct"]
    requires: ["code_generation"]
  charting_artist:
    pools: ["technical_longseq"]
    allow_models: [
      "moonshotai/Kimi-K2-Instruct",
      "Qwen/Qwen3-Coder-480B-A35B-Instruct",
      "deepseek-ai/DeepSeek-V3",
      "zai-org/GLM-4.5"
    ]
    prefer_models: ["moonshotai/Kimi-K2-Instruct"]
    requires: ["code_generation", "visualization"]
    post_processing: true
    max_cost_per_task: 0.05
  chief_writer:
    pools: ["deep_reasoning"]
    allow_models: [
      "gemini-2.5-pro",
      "gemini-api/gemini-2.5-pro",
      "deepseek-ai/DeepSeek-V3",
      "deepseek-chat",
      "deepseek-ai/DeepSeek-R1"
    ]
    prefer_models: ["gemini-api/gemini-2.5-pro", "gemini-2.5-pro"]
    fallback_chain: [
      "gemini-api/gemini-2.5-pro",
      "gemini-2.5-pro",
      "deepseek-ai/DeepSeek-V3",
      "deepseek-chat",
      "deepseek-ai/DeepSeek-R1"
    ]

# ä»»åŠ¡ç±»å‹ç»‘å®šï¼ˆè¿›ä¸€æ­¥ç»†åŒ–æ± å†…å€™é€‰ï¼‰
task_bindings:
  code_generation:
    allow_models: ["Qwen/Qwen3-Coder-480B-A35B-Instruct", "zai-org/GLM-4.5"]
    prefer_models: ["Qwen/Qwen3-Coder-480B-A35B-Instruct"]
  news_analysis:
    allow_models: ["deepseek-ai/DeepSeek-V3", "Qwen/Qwen3-235B-A22B-Instruct-2507"]
  decision_making:
    allow_models: ["gemini-2.5-pro", "deepseek-ai/DeepSeek-R1"]
    prefer_models: ["gemini-2.5-pro"]
  visualization:
    allow_models: ["Qwen/Qwen3-Coder-480B-A35B-Instruct", "deepseek-ai/DeepSeek-V3"]
    prefer_models: ["Qwen/Qwen3-Coder-480B-A35B-Instruct"]
    requires: ["code_generation"]

# æ± å†…æ‰“åˆ†æƒé‡ï¼ˆè´¨é‡/æ€§èƒ½/æˆæœ¬æƒè¡¡ï¼Œå¯æŒ‰è§’è‰²è¦†å†™ï¼‰
intra_pool_weights:
  default: { quality: 0.55, performance: 0.30, cost: 0.15 }
  tool_engineer: { quality: 0.40, performance: 0.25, cost: 0.05, capability_match: 0.30 }
  decision_making: { quality: 0.65, performance: 0.25, cost: 0.10 }

# è¿è¡Œæ—¶è¦†å†™å¼€å…³
runtime_overrides:
  enable_model_lock: true
  enable_allowed_models_by_role: true
  exploration_rate: 0.05
# æ™ºèƒ½è·¯ç”±é…ç½® - ä¸‰æ± æ˜ å°„ç­–ç•¥ï¼ˆå¼ºåˆ¶å¤šæ ·åŒ–å¢å¼ºç‰ˆï¼‰
routing:
  strategy: "pool_based_intelligent"  # åŸºäºæ± çš„æ™ºèƒ½è·¯ç”±
  enable_caching: true
  cache_ttl: 3600
  
  # å¼ºåˆ¶å¤šæ ·åŒ–é…ç½®ï¼ˆå¢å¼ºç‰ˆï¼‰
  force_diversity: true        # å¯ç”¨å¼ºåˆ¶å¤šæ ·åŒ–
  diversity_threshold: 0.4     # é™ä½é˜ˆå€¼åˆ°40%ï¼Œæ›´æ—©è§¦å‘
  diversity_weight: 0.8        # æé«˜å¤šæ ·åŒ–æƒé‡åˆ°80%
  diversification_priority: 0.8  # å¤šæ ·åŒ–ä¼˜å…ˆçº§
  
  # ä¸‰æ± æ˜ å°„è§„åˆ™
  pool_mapping:
    # ğŸ§  é€šç”¨æ·±åº¦æ¨ç†æ± æ˜ å°„
    deep_reasoning:
      target_agents: ["fundamental_expert", "chief_decision_officer", "risk_manager", "policy_researcher", "compliance_officer"]
      task_types: ["financial_report", "risk_assessment", "decision_making", "policy_analysis", "compliance_check"]
      complexity_threshold: "high"  # é«˜å¤æ‚åº¦ä»»åŠ¡
      multimodal_required: true
      reasoning_required: true
      
    # ğŸ”„ æŠ€æœ¯é¢&é•¿åºåˆ—&ä»£ç è®¡ç®—æ± æ˜ å°„ (åˆå¹¶ä»£ç è®¡ç®—åŠŸèƒ½)
    technical_longseq:
      target_agents: ["technical_analyst", "news_hunter", "sentiment_analyst", "tool_engineer"]
      task_types: ["technical_analysis", "news_analysis", "sentiment_analysis", "tool_development", "code_generation", "backtesting"]
      context_length_threshold: 20000  # è¶…è¿‡20Kä¸Šä¸‹æ–‡
      chinese_optimized: true
      time_series_data: true
      code_generation_required: true  # æ–°å¢ä»£ç ç”Ÿæˆèƒ½åŠ›
      
    # ğŸ’» ä»£ç /è¡¨æ ¼è®¡ç®—æ± æ˜ å°„ - åˆ é™¤ç‹¬ç«‹æ± ï¼Œåˆå¹¶åˆ°technical_longseq
    # code_computation:
    #   target_agents: ["tool_engineer", "chief_decision_officer"]  # éœ€è¦ä»£ç ç”Ÿæˆçš„ä»»åŠ¡
    #   task_types: ["code_generation", "backtesting", "table_computation", "factor_analysis"]
    #   code_generation_required: true
    #   structured_output_required: true
  
  # è·¯ç”±æƒé‡é…ç½®ï¼ˆè´¨é‡ä¼˜å…ˆï¼‰
  weights:
    quality: 0.6         # è´¨é‡æƒé‡æœ€é«˜
    performance: 0.3     # æ€§èƒ½æƒé‡
    cost: 0.1           # æˆæœ¬æƒé‡æœ€ä½ï¼ˆè´¨é‡ä¼˜å…ˆï¼‰
    availability: 0.0    # å¯ç”¨æ€§é€šè¿‡fallbackä¿è¯
  
  # ç†”æ–­å™¨é…ç½®
  circuit_breaker:
    failure_threshold: 3      # é™ä½å¤±è´¥é˜ˆå€¼ï¼Œå¿«é€Ÿåˆ‡æ¢
    recovery_timeout: 180     # ç¼©çŸ­æ¢å¤æ—¶é—´
    half_open_requests: 2
    
  # é‡è¯•ç­–ç•¥
  retry_policy:
    max_attempts: 2          # å‡å°‘é‡è¯•æ¬¡æ•°ï¼Œä¾èµ–fallback
    base_delay: 0.5
    max_delay: 5.0
    exponential_backoff: true
    jitter: true

# æˆæœ¬ç®¡ç†
cost_management:
  # æˆæœ¬é™åˆ¶
  limits:
    session_max: 1.00        # å•æ¬¡ä¼šè¯æœ€å¤§æˆæœ¬ï¼ˆç¾å…ƒï¼‰
    daily_max: 10.00         # æ¯æ—¥æœ€å¤§æˆæœ¬
    monthly_max: 300.00      # æ¯æœˆæœ€å¤§æˆæœ¬
    
  # æˆæœ¬ç›‘æ§
  monitoring:
    enabled: true
    alert_threshold: 0.80    # å‘Šè­¦é˜ˆå€¼ï¼ˆå é™é¢ç™¾åˆ†æ¯”ï¼‰
    track_by_agent: true     # æŒ‰æ™ºèƒ½ä½“è·Ÿè¸ªæˆæœ¬
    track_by_model: true     # æŒ‰æ¨¡å‹è·Ÿè¸ªæˆæœ¬

# æ€§èƒ½ä¼˜åŒ– - è´¨é‡ä¼˜å…ˆé…ç½®
performance:
  # å¹¶å‘æ§åˆ¶ï¼ˆè´¨é‡ä¼˜å…ˆï¼Œé€‚åº¦å¹¶å‘ï¼‰
  concurrency:
    max_concurrent_requests: 3  # é™ä½å¹¶å‘ï¼Œä¿è¯è´¨é‡
    max_queue_size: 15
    request_timeout: 180        # å¢åŠ è¶…æ—¶ï¼Œæ”¯æŒæ·±åº¦æ¨ç†
    
  # ç¼“å­˜ç­–ç•¥
  caching:
    enabled: true
    max_cache_size: 2000        # å¢å¤§ç¼“å­˜
    ttl: 7200                   # å»¶é•¿ç¼“å­˜æ—¶é—´
    cache_by_model: true
    cache_by_pool: true         # æŒ‰æ± ç¼“å­˜
    
  # é¢„çƒ­ç­–ç•¥ - ä¸‰æ± æ——èˆ°æ¨¡å‹
  warmup:
    enabled: true
    warmup_requests: 1          # å‡å°‘é¢„çƒ­è¯·æ±‚
    warmup_models: 
      - "gemini-2.5-pro"         # æ·±åº¦æ¨ç†æ± æ——èˆ°
      - "deepseek-ai/DeepSeek-V3" # æŠ€æœ¯é•¿åºåˆ—æ± æ——èˆ°
      
  # è´¨é‡ä¼˜åŒ–å‚æ•° - æ——èˆ°æ¨¡å‹æœ€å¤§tokené…ç½®ï¼ˆä¸è®¡æˆæœ¬ï¼‰
  quality_settings:
    temperature: 0.2             # ä½æ¸©åº¦ï¼Œæé«˜ä¸€è‡´æ€§
    top_p: 0.9
    max_tokens: 100000           # å…¨å±€é»˜è®¤å€¼ï¼Œå„æ¨¡å‹å°†ä½¿ç”¨å„è‡ªä¸Šé™
    presence_penalty: 0.0
    frequency_penalty: 0.0
    
    # å„æ——èˆ°æ¨¡å‹ä¸“ç”¨tokenä¸Šé™ï¼ˆä¸è®¡æˆæœ¬ï¼‰- åŸºäºå®˜ç½‘å®é™…é™åˆ¶
    flagship_token_limits:
      "gemini-2.5-pro": 1000000      # Googleå®˜ç½‘ - 1M tokens
      "deepseek-ai/DeepSeek-V3": 128000  # SiliconFlowå¹³å° - 128K tokens (æ¯”DeepSeekå®˜ç½‘64Kæ›´é«˜)

# ç›‘æ§å’Œæ—¥å¿—
monitoring:
  # æŒ‡æ ‡æ”¶é›†
  metrics:
    enabled: true
    collect_latency: true
    collect_throughput: true
    collect_error_rate: true
    collect_cost: true
    
  # æ—¥å¿—çº§åˆ«
  logging:
    level: "INFO"            # DEBUG, INFO, WARNING, ERROR
    log_requests: true
    log_responses: false     # ä¸è®°å½•å“åº”å†…å®¹ï¼Œä¿æŠ¤éšç§
    log_performance: true
    
  # å¥åº·æ£€æŸ¥
  health_check:
    enabled: true
    interval: 300            # å¥åº·æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    timeout: 30              # å¥åº·æ£€æŸ¥è¶…æ—¶

# åä½œæ¨¡å¼é…ç½®
collaboration:
  modes:
    # ä¸²è¡Œåä½œ
    sequential:
      description: "æ™ºèƒ½ä½“ä¾æ¬¡åˆ†æï¼Œå±‚å±‚é€’è¿›"
      max_agents: 9
      timeout_per_agent: 120
      
    # å¹¶è¡Œåä½œ  
    parallel:
      description: "æ™ºèƒ½ä½“åŒæ—¶åˆ†æï¼Œè§‚ç‚¹æ•´åˆ"
      max_agents: 6
      timeout_total: 180
      
    # è¾©è®ºåä½œ
    debate:
      description: "æ™ºèƒ½ä½“äº’ç›¸è´¨ç–‘ï¼Œè¾¾æˆå…±è¯†"
      max_agents: 4
      max_rounds: 3
      timeout_per_round: 200

# å®‰å…¨å’Œåˆè§„
security:
  # APIå¯†é’¥ç®¡ç†
  api_keys:
    encrypt_at_rest: false   # é™æ€åŠ å¯†ï¼ˆéœ€è¦åŠ å¯†å¯†é’¥ï¼‰
    rotate_interval: 90      # å¯†é’¥è½®æ¢é—´éš”ï¼ˆå¤©ï¼‰
    
  # æ•°æ®éšç§
  privacy:
    anonymize_logs: true     # åŒ¿ååŒ–æ—¥å¿—
    data_retention: 30       # æ•°æ®ä¿ç•™å¤©æ•°
    
  # è®¿é—®æ§åˆ¶
  access_control:
    require_auth: false      # æ˜¯å¦éœ€è¦è®¤è¯
    rate_limiting: true      # é€Ÿç‡é™åˆ¶
    requests_per_minute: 60

# è°ƒè¯•å’Œå¼€å‘
debug:
  enabled: false
  verbose_logging: false
  save_requests: false       # ä¿å­˜è¯·æ±‚ç”¨äºè°ƒè¯•
  save_responses: false      # ä¿å­˜å“åº”ç”¨äºè°ƒè¯•
  mock_responses: false      # ä½¿ç”¨æ¨¡æ‹Ÿå“åº”
